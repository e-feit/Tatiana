# Требования
* Python 3
* MySQL 5.5+/MariaDB 5.5+

# Установка
Создать новый `venv` и установить необходимые зависимости.
```
python3 -m venv venv
. venv/bin/activate
pip install -r requirements.txt
```

# Запуск
```
# активировать venv, если еще не сделано
. venv/bin/activate

# создать все нужные таблицы в БД (необходимо делать после каждого обновления)
flask db upgrade

# указать перменную и запустить
export FLASK_APP=app.py; flask run

# выйти из venv, если нужно
deactivate
```

# Разработка
Полезные для разработки конфиги (должны быть установлены перед запуском).
```
# активировать отладчик (debugger)
export FLASK_ENV=development

# авто-обновление при изменении файлов (не нужно будет перезапускать процесс)
export FLASK_DEBUG=1
```

# Внести изменения в БД
Для управления изменениями используется Flask-Migrate. Чтобы внести изменения
в структуру таблиц или создать новую, нужно отредактировать файл `app/db/models.py`.

Ни в коем случае не редактировать таблицы вручную! Иначе это потом будет сложно отследить.

Типы данных и другую документацию можно посмотреть [здесь](http://flask-sqlalchemy.pocoo.org/2.3/models/).

После редактирования моделей в файле `app/db/models.py`, нужно сгенерировать новый файл изменений
с коротким описанием, что было изменено. Например:
```
flask db migrate -m 'create users table'
```

Если нужно внести какое-то изменение, которое не подразумевает измененией самих моделей
(например заполнить все значения определенного поля), можно создать пустой файл миграции
и в нем использовать, например, чистый SQL.
```
flask db revision -m 'set all users names to empty'

```
И потом в сгенерированном файле:
```
def upgrade():
    connection = op.get_bind()

    result = connection.execute("""

    UPDATE users
       SET username = ''

    """)
```

После чего запустить апгрейд, который и внесёт все изменения в БД.
Этот процесс можно запускать сколько угодно раз, он автоматически запоминает,
что он уже выполнил, а что - нет. Для этого существует специальная таблица `alembic_version`,
которую не нужно трогать.
```
flask db upgrade
```

Важно: выше сгенерированый файл обязательно добавить в git.

# Запустить тесты
Перед запуском не забыть войти в `venv`, все зависимости так же должны быть установлены 
(см. п. Установка).

Тесты запускаются командой:
```
python -m pytest -v app/
```

# Добавить/удалить зависимости
Опять же, не забыть войти в `venv`.
```
. venv/bin/activate
```
Для добавления новых зависимостей используем `pip`.
```
pip install Flask-Assets
```

После этого обязательно нужно обновить файл `requirements.txt`.
```
pip freeze > requirements.txt
```

Если что-то удаляем, то так же не забываем обновить `requirements.txt`.
```
pip uninstall Flask-Assets
pip freeze > requirements.txt
```